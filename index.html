<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Oscilloscope pédagogique</title>
    <style>
        html,
        body {
            height: 100%;
            margin: 0;
            background: #0e0f12;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .scope {
            position: relative;
            width: 100%;
            max-width: 1200px;
            height: auto;
        }

        .scope img {
            width: 100%;
            height: auto;
            display: block;
        }

        canvas#trace {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .panel {
            position: absolute;
            top: 5%;
            left: 5%;
            background: rgba(255, 255, 255, .95);
            border-radius: 10px;
            padding: 10px;
        }

        .legend {
            position: absolute;
            bottom: 2%;
            right: 2%;
            background: rgba(255, 255, 255, .9);
            border-radius: 6px;
            padding: 6px;
            font-size: 12px;
        }
    </style>
</head>

<body>
    <div class="scope">
        <img src="Oscilloscope.png" alt="Oscilloscope pédagogique" />
        <canvas id="trace"></canvas>

        <form class="panel" id="controls">
            <label>Forme
                <select id="wave">
                    <option value="sine">Sinusoïdal</option>
                    <option value="square">Carré</option>
                    <option value="triangle">Triangle</option>
                </select>
            </label>
            <label>Fréquence (Hz)
                <input id="freq" type="number" value="50" />
            </label>
            <label>Amplitude crête (V)
                <input id="amp" type="number" value="2" />
            </label>
            <label>Décalage DC (V)
                <input id="offset" type="number" value="0" />
            </label>
            <label>Périodes à afficher
                <input id="cycles" type="number" value="2" />
            </label>
        </form>

        <div class="legend">Écran : 10 div horizontales × 8 div verticales.<br>Échelle verticale : V/div — horizontale :
            s/div.<br>Ligne rouge = composante continue.</div>
    </div>

    <script>
        const cvs = document.getElementById('trace');
        const ctx = cvs.getContext('2d');
        // Zone de quadrillage (pour clip) exprimée en pourcentage de l'image
        // (mesures relevées sur l'illustration fournie)
        const SCREEN_PERC = { left: 0.1091, top: 0.177, width: 0.5545, height: 0.657 };

        function resizeCanvas() {
            const rect = cvs.getBoundingClientRect();
            const dpr = window.devicePixelRatio || 1;
            cvs.width = rect.width * dpr;
            cvs.height = rect.height * dpr;
            ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
        }

        const ui = {
            wave: document.getElementById('wave'),
            freq: document.getElementById('freq'),
            amp: document.getElementById('amp'),
            offset: document.getElementById('offset'),
            cycles: document.getElementById('cycles')
        };

        function generate() {
            const points = [];
            const width = cvs.getBoundingClientRect().width;
            const f = parseFloat(ui.freq.value);
            const A = parseFloat(ui.amp.value);
            const DC = parseFloat(ui.offset.value);
            const cycles = parseFloat(ui.cycles.value);

            const T = 1 / f;
            const secTotal = cycles * T;
            const stepT = secTotal / (width - 1);

            for (let x = 0; x < width; x++) {
                const t = x * stepT;
                let y = 0;
                switch (ui.wave.value) {
                    case 'sine': y = A * Math.sin(2 * Math.PI * f * t); break;
                    case 'square': y = (Math.sin(2 * Math.PI * f * t) >= 0 ? A : -A); break;
                    case 'triangle': {
                        const frac = (t / T) - Math.floor(t / T + 0.5);
                        y = A * (2 * Math.abs(2 * frac) - 1);
                    } break;
                }
                y += DC;
                points.push({ x, y });
            }
            return points;
        }

        function draw() {
            resizeCanvas();
            const points = generate();
            const rect = cvs.getBoundingClientRect();
            const width = rect.width; const height = rect.height;
            ctx.clearRect(0, 0, width, height);

            // Calcul de la zone "écran" (quadrillage) en pixels
            const sx = SCREEN_PERC.left * width;
            const sy = SCREEN_PERC.top * height;
            const sw = SCREEN_PERC.width * width;
            const sh = SCREEN_PERC.height * height;

            // Echelles dans la zone écran
            const centerY = sy + sh / 2;
            const A = Math.abs(parseFloat(ui.amp.value));
            const DC = parseFloat(ui.offset.value);
            const scaleY = (sh / 2) / Math.max(1e-9, A + Math.abs(DC));

            // Clip pour empêcher la trace de dépasser du quadrillage
            ctx.save();
            ctx.beginPath(); ctx.rect(sx, sy, sw, sh); ctx.clip();

            // Trace du signal — vert foncé (style oscillo 80s)
            ctx.lineWidth = 6;               // plus épais
            ctx.strokeStyle = '#0a7d2c';     // vert foncé
            ctx.beginPath();
            points.forEach((p, i) => {
                const x = sx + (p.x / width) * sw;          // re-map x dans la zone écran
                const y = centerY - p.y * scaleY;
                if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
            });
            ctx.stroke();

            // Ligne de composante continue (offset) — rouge
            ctx.lineWidth = 2;
            ctx.strokeStyle = '#d11';
            ctx.beginPath();
            const yDC = centerY - DC * scaleY;
            ctx.moveTo(sx, yDC); ctx.lineTo(sx + sw, yDC);
            ctx.stroke();

            ctx.restore();
        });
        ctx.stroke();
    }

        window.addEventListener('resize', draw);
        Object.values(ui).forEach(el => el.addEventListener('input', draw));
        draw();
    </script>
</body>

</html>